name: RSS to X

on:
  schedule:
    # Spotify の RSS がすぐに更新されるわけではないので毎時 30 分に実行し、
    # その時点で最新のエピソードを取得する
    - cron: "30 * * * *"
  workflow_dispatch:
    inputs:
      update_within_minutes:
        description: "UPDATE_WITHIN_MINUTES (手動実行用)"
        required: false
        default: "10"

jobs:
  rss-to-x:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        # account: [RIDDLE, HIBINO] # アカウント名を変更
        account: [RIDDLE] # アカウント名を変更
    steps:
      - name: Checkout
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683

      - name: RSS to X (${{ matrix.account }})
        uses: azu/rss-to-twitter@7e20a41d61766ec62ccee5629e964518b33aa87e
        with:
          RSS_URL: "https://anchor.fm/s/105812508/podcast/rss"
          TWEET_TEMPLATE: |
            ポッドキャスト「ゆるITエンジニア道場」で「%title%」を公開しました！

            🎧 %url%

            #ゆるIT
          UPDATE_WITHIN_MINUTES: ${{ github.event.inputs.update_within_minutes || '10' }}
          TWITTER_APIKEY: ${{ secrets[format('X_API_KEY_{0}', matrix.account)] }}
          TWITTER_APIKEY_SECRET: ${{ secrets[format('X_API_SECRET_{0}', matrix.account)] }}
          TWITTER_ACCESS_TOKEN: ${{ secrets[format('X_ACCESS_TOKEN_{0}', matrix.account)] }}
          TWITTER_ACCESS_TOKEN_SECRET: ${{ secrets[format('X_ACCESS_TOKEN_SECRET_{0}', matrix.account)] }}
